<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Student Chat</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    :root {
      --bg: #f0f2f5;
      --fg: #1c1c1c;
      --msg-bg: #ffffff;
      --user-msg: #d1e7dd;
    }
    .dark {
      --bg: #121212;
      --fg: #e0e0e0;
      --msg-bg: #1e1e1e;
      --user-msg: #2a4033;
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .header {
      text-align: center;
      padding: 2rem 1rem 1rem;
      background: linear-gradient(90deg, #ffd6e7, #e3dcff, #d1ecff);
      border-bottom: 1px solid #ccc;
      border-radius: 0 0 20px 20px;
    }
    .header h1 { font-weight: bold; font-size: 2rem; margin-bottom: 0.5rem; }
    .header p { margin: 0; font-size: 1rem; color: gray; }
    .suggestions { display: flex; justify-content: center; flex-wrap: wrap; gap: 0.5rem; padding: 1rem; }
    .suggestions button { background: white; border: 1px solid #ccc; padding: 0.6rem 1rem; border-radius: 999px; cursor: pointer; font-size: 0.9rem; transition: 0.3s; }
    .suggestions button:hover { background: #0d6efd; color: white; border-color: #0d6efd; }
    .main { flex: 1; display: flex; flex-direction: column; margin: 1rem; }
    .chat-area { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; }
    .chat-msg, .input-msg { background: var(--msg-bg); max-width: 1050px; width: 100%; margin: 1rem auto; padding: 1rem; border-radius: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; animation: slideUp 0.5s ease; }
    .chat-msg.user { background: var(--user-msg); }
    .chat-msg.assistant { background: var(--msg-bg); }
    .chat-msg .role { font-weight: bold; font-size: 0.9rem; margin-bottom: 0.5rem; }
    .input-msg form { display: flex; gap: 0.5rem; align-items: center; position: relative; flex-wrap: wrap; }
    .input-msg input[type="text"] { flex: 1; padding: 0.8rem 1rem; border: 1px solid #ccc; border-radius: 999px; background: var(--bg); color: var(--fg); }
    .input-msg button { background: #0d6efd; border: none; color: white; border-radius: 50%; width: 48px; height: 48px; font-size: 20px; display: flex; justify-content: center; align-items: center; cursor: pointer; }
    .mic-button {
      background: #6c757d;
      border: none;
      color: white;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: background 0.3s, transform 0.3s;
    }
    .mic-button.recording {
      background: #dc3545;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

<button onclick="toggleDarkMode()" style="position:fixed;top:10px;right:10px;z-index:999" class="btn btn-sm btn-dark">üåô</button>

<div class="header">
  <h1>Welcome to AI Student Chat!</h1>
  <p>Ask your academic questions ‚Äî math, science, coding, anything!</p>
</div>

<div class="suggestions">
  <button onclick="autoAsk('Solve a Math Problem')">üßÆ Solve a Math Problem</button>
  <button onclick="autoAsk('Explain a Science Concept')">üß™ Explain a Science Concept</button>
  <button onclick="autoAsk('Summarize a Paragraph')">üìö Summarize a Paragraph</button>
  <button onclick="autoAsk('Debug My Code')">üíª Debug My Code</button>
</div>

<div class="main">
  <div class="chat-area" id="chat-container">
    {% for message in conversation %}
      <div class="chat-msg {% if message.role == 'user' %}user{% else %}assistant{% endif %}">
        <div class="role">{% if message.role == 'user' %}üë®‚Äçüéì You:{% else %}ü§ñ AI:{% endif %}</div>
        {{ message.content | safe }}
      </div>
    {% endfor %}
  </div>

  <div class="input-msg">
    <form method="POST" enctype="multipart/form-data" id="chat-form">
      <button type="button" id="micButton" class="mic-button">üé§</button>
      <input type="text" name="question" id="user-input" placeholder="Ask me anything..." required>
      <input type="file" name="image" id="imageInput" accept="image/*" style="display:none;">
      <button type="submit">‚û§</button>
    </form>
  </div>
</div>

<script>
function toggleDarkMode() { document.body.classList.toggle("dark"); }
function scrollToBottom() { const container = document.getElementById('chat-container'); container.scrollTop = container.scrollHeight; }
window.onload = scrollToBottom;

function autoAsk(text) {
  const input = document.getElementById('user-input');
  input.value = text;
  document.getElementById('chat-form').submit();
}

const micButton = document.getElementById('micButton');
const inputField = document.getElementById('user-input');

if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.lang = 'en-US';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  micButton.addEventListener('click', () => {
    recognition.start();
    micButton.classList.add('recording');
  });

  recognition.addEventListener('result', (event) => {
    const transcript = event.results[0][0].transcript;
    inputField.value = transcript;
    setTimeout(() => {
      document.getElementById('chat-form').submit();
    }, 500);
  });

  recognition.addEventListener('end', () => {
    micButton.classList.remove('recording');
  });
} else {
  micButton.disabled = true;
  micButton.title = "Voice input not supported";
}
</script>

</body>
</html>
